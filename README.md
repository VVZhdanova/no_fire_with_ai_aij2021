МЧС: прогнозирование степени пожароопасности
=================================

Соревнование алгоритмов прогнозирующих пожароопасность региона на 8 дней вперёд. 

Участникам предлагается спрогнозировать пожар в определённом регионе России используя различные, имеющиеся в открытом доступе, данные.

## Постановка задачи

Разобьём пространство на территории России на ячейки размером 0,2x0,2 градуса и для каждой ячейки поставим метку пересечения с полигоном пожара в соответствующий день. Таким образом, получим набор прямоугольников с меткой 1, если этот участок горел, и 0 в обратном случае.

Требуется разработать алгоритм, выдающий бинарную (0 или 1) вероятность пожара на 1, 2, 3, 4, 5, 6, 7 и 8 дней вперёд для заданной ячейки на определённую дату. Решение должно быть реализовано в виде программы, которая принимает на вход CSV таблицу с точками (координаты  `latitude`,  `longitude`  и дата получения точки  `dt`). На выход необходимо формировать таблицу где для каждой точки будут указаны 8 чисел (0 или 1) означающие наличие пожара через 1, 2, 3, 4, 5, 6, 7 и 8 дней соответственно.

В качестве входных данных, доступных участникам как на момент обучения моделей, так и в момент инференса в проверяющей системе, могут быть использованы:

-   Фактические данные о пожарах (время и контур);
-   [ERA5](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land)  — данные реанализа "(2019): ERA5-Land hourly data from 1981 to present. Copernicus Climate Change Service (C3S) Climate Data Store (CDS)".

Также участники могут использовать для обучения моделей любые открытые источники данных, например спутниковые снимки и индексы пожароопасности. Однако стоит учитывать, что после загрузки решения в проверяющую систему у моделей не будет доступа в интернет и все необходимые для прогноза дополнительные данные нужно упаковать в docker-контейнер.


## Формат решения

В проверяющую систему необходимо отправить код алгоритма, запакованный в ZIP-архив (подробности в `Baseline.ipynb`). Решения запускаются в изолированном окружении при помощи Docker. Время и ресурсы во время тестирования ограничены. Участнику нет необходимости разбираться с технологией Docker.

### Содержимое контейнера

В корне архива обязательно должен быть файл metadata.json следующего содержания:
```json
{
    "image": "sberbank/mchs-python",
    "entry_point": "python3 /app/solution.py"
}
```

Здесь `image` — поле с названием docker-образа, в котором будет запускаться решение, `entry_point` — команда, при помощи которой запускается решение. Для решения текущей директорией будет являться корень архива. 

Для запуска решений можно использовать существующие окружения:

- `sberbank/mchs-python` — Python3 с установленным большим набором библиотек
- `gcc` - для запуска компилируемых C/C++ решений
- `node` — для запуска JavaScript
- `openjdk` — для Java
- `mono` — для C#

Подойдет любой другой образ, доступный для загрузки из DockerHub. При необходимости, Вы можете подготовить свой образ, добавить в него необходимое ПО и библиотеки (см. инструкцию по созданию Docker-образов); для использования его необходимо будет опубликовать на DockerHub.

### Ограничения

Контейнер с решением запускается в следующих условиях:

- решению доступны ресурсы
  - 16 Гб оперативной памяти;
  - 4 vCPU;
  - 1 GPU Tesla V100.
- время на выполнение решения: 30 минут
- решение не имеет доступа к ресурсам интернета
- максимальный размер упакованного и распакованного архива с решением: 10 Гб
- максимальный размер используемого Docker-образа: 15 Гб


## Проверка качества

Качество решения оценивается на отложенной выборке - на данных за 8 дней после завершения приёма решений.  

Целью данного соревнования является прогнозирование начала пожара. Оценка как быстро этот пожар потушат зависит от многих факторов и не является приоритетной для данной задачи. Поэтому для расчёта метрики используются только метки начала пожара. Для этого после первой метки начала пожара (т. е. "1" в прогнозе) будем считать, что ячейка "горит" все оставшиеся дни:
|  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|--|--|--|--|--|--|--|--|--|
| pred1 | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 0 |
| pred1_corr |0|0|0|0|0|1|1|1|

Делаем ту же операцию для Ground Truth (т.е после первой "единички" пожара заполняем все дни единицами).

Сравниваем скорректированный прогноз для ячейки и скорректированный ground truth:
|  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|--|--|--|--|--|--|--|--|--|
| pred1_corr | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 |
| gt_corr |0|0|0|1|1|1|1|1|
| diff1 |0|0|0|**-1**|**-1**|0|0|0|  

Поскольку важно спрогнозировать пожар заранее, поздний прогноз пожара увеличивает штраф вдвое (отрицательные значения в строке diff умножаются на -2.

Вспомогательная переменная penalty показывает величину штрафа с учётом того в какую сторону прогноз был ошибочен:
```
penalty1 = (-1)*(-2) + (-1)*(-2) = 4
```
Итоговая ошибка для приведённой строки считается по формуле:
```
err1 = (C**(penalty1 / max(penalty)) - 1) / (C-1) = (20 ** (4/16) - 1) / (20 - 1) = 0,0587
где С=20 - нормировочный коэффициент.
```

Для похожего прогноза, но прогнозирующего пожар на 2 дня раньше ошибка считается аналогично:

|  | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 |
|--|--|--|--|--|--|--|--|--|
| pred2_corr |0|1|1|1|1|1|1|1|
| gt_corr |0|0|0|1|1|1|1|1|
| diff2 |0|**1**|**1**|0|0|0|0|0|

Пожар спрогнозирован заранее, значения diff2 положительные и входят в переменную penalty с весом 1:
```
penalty2 = sum(diff2) = 2
```
Итоговая ошибка для приведённой строки считается по формуле:
```
err2 = (C**(penalty2 / max(penalty)) - 1) / (C-1) = (20 ** (2/16) - 1) / (20 - 1) = 0.0239
где С=20 - нормировочный коэффициент.
```

Ошибки для всех строк в прогнозе усредняются, формируя метрику лидерборда. Для датасета из двух представленных выше прогнозов общая ошибка составит:
```
total = (err1 + err2) / 2 = 0.0413
```

Для финальной оценки можно выбрать 3 решения. По умолчанию это решения с наилучшей метрикой на public-лидерборде.
